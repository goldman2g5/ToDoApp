@page "/"
@using ToDoApp.Client.Models;
@using ToDoApp.Client.Data;
@using Syncfusion.Blazor.Data


<PageTitle>Index</PageTitle>

<SfSchedule @ref="ScheduleRef" TValue="AppointmentData" Height="650px">
    <ScheduleEvents TValue="AppointmentData" ActionCompleted="OnActionCompleted"></ScheduleEvents>
    <ScheduleEventSettings DataSource="@DataSource" TValue="AppointmentData"></ScheduleEventSettings>
    <ScheduleViews>
        <ScheduleView Option="View.Day"></ScheduleView>
        <ScheduleView Option="View.Week"></ScheduleView>
        <ScheduleView Option="View.WorkWeek"></ScheduleView>
        <ScheduleView Option="View.Month"></ScheduleView>
        <ScheduleView Option="View.Agenda"></ScheduleView>
    </ScheduleViews>
</SfSchedule>

@code {
    SfSchedule<AppointmentData> ScheduleRef;

    List<AppointmentData> DataSource = new List<AppointmentData>();

    string Status = "";

    public async void OnActionCompleted(ActionEventArgs<AppointmentData> args)
    {
        if (args.ActionType == ActionType.EventCreate)
        {
            Status = "Success";
            await AppointmentService.Create(args.AddedRecords[0]);
        }
    }

    protected override async Task OnInitializedAsync()
    {
        List<AppointmentData> appointments = await AppointmentService.GetAll();

        foreach (AppointmentData i in appointments)
        {
           
            await ScheduleRef.AddEventAsync(i);
        }
    }
}